<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>23plusone Happiness Scan</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: white;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #333;
      overflow-x: hidden; /* Prevent horizontal scrollbars */
    }
    
    .container {
      width: 100%;
      max-width: 1080px;
      padding: 20px;
      overflow: visible; /* Allow cards to animate outside */
    }
    
    #game {
      background: white;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      text-align: center;
      min-height: 500px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      overflow: visible; /* Allow swipe animations to extend outside */
    }
    
    #intro {
      background: white;
      border-radius: 8px;
      padding: 40px 30px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      text-align: center;
      min-height: 500px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      animation: fadeInUp 0.8s ease forwards;
    }
    
    #introContent {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 20px 0;
    }
    
    #introContent h1 {
      font-size: 32px;
      font-weight: 700;
      color: #333;
      margin-bottom: 20px;
      animation: fadeInUp 0.6s ease 0.2s both;
    }
    
    #introContent p {
      font-size: 18px;
      line-height: 1.6;
      color: #555;
      margin-bottom: 12px;
      animation: fadeInUp 0.6s ease 0.4s both;
    }
    
    #introContent p.lets-go {
      font-size: 20px;
      font-weight: 600;
      color: #e91e63;
      margin-top: 10px;
      margin-bottom: 30px;
      animation: fadeInUp 0.6s ease 0.6s both;
    }
    
    #startBtn {
      background: #e91e63;
      color: white;
      padding: 18px 40px;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 20px auto 0 auto;
      max-width: 280px;
      width: 100%;
      animation: fadeInUp 0.6s ease 0.8s both;
    }
    
    #startBtn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(233, 30, 99, 0.3);
    }
    
    #progress {
      background: #e0e0e0;
      height: 6px;
      border-radius: 3px;
      margin-bottom: 20px;
      overflow: hidden;
    }
    
    #progressBar {
      height: 100%;
      background: #e91e63;
      width: 0%;
      transition: width 0.3s ease;
    }
    
    #cardContainer {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    #card {
      margin: 20px 0;
    }
    
    #cardImages {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px 0;
      min-height: 250px; /* Increased height for better visual focus */
      overflow: visible; /* Allow cards to animate outside bounds */
      position: relative;
    }
    
    .card-image {
      max-width: 100%;
      max-height: 250px; /* Increased from 200px for better visibility */
      width: auto;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 12px 24px rgba(0,0,0,0.15); /* Enhanced shadow for focus */
      opacity: 1;
      object-fit: contain;
      transition: transform 0.2s ease; /* Add subtle hover effect */
    }
    
    .card-image:hover {
      transform: scale(1.02); /* Subtle zoom on hover */
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    #timerContainer {
      margin: 20px 0;
    }
    
    #timerBar {
      height: 8px;
      background: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
      margin: 10px 0;
    }
    
    #timerProgress {
      height: 100%;
      background: #4CAF50; /* Start with green */
      width: 100%;
      transition: width 4s linear, background-color 0.3s ease;
      border-radius: 4px;
    }
    
    #timerProgress.warning {
      background: #FF9800 !important; /* Orange when time is running low */
    }
    
    #timerProgress.danger {
      background: #F44336 !important; /* Red when almost out of time */
      animation: pulse 0.5s infinite alternate;
    }
    
    @keyframes pulse {
      from { opacity: 0.7; }
      to { opacity: 1.0; }
    }
    
    #timerText {
      font-size: 14px;
      color: #666;
      margin-bottom: 10px;
    }
    
    .buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
    }
    
    button {
      padding: 15px 30px;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 100px;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    
    #yesBtn {
      background: #4CAF50;
      color: white;
      transition: all 0.2s ease;
    }
    
    #yesBtn:hover {
      background: #45a049;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }
    
    #yesBtn:active {
      transform: scale(0.95);
      background: #66bb6a;
    }
    
    #noBtn {
      background: #f44336;
      color: white;
      transition: all 0.2s ease;
    }
    
    #noBtn:hover {
      background: #da190b;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
    }
    
    #noBtn:active {
      transform: scale(0.95);
      background: #ef5350;
    }
    
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }
    
    /* Improved Results Section Styling */
    #results {
      background: white;
      border-radius: 8px;
      padding: 40px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      text-align: center;
      max-width: 900px;
      margin: 0 auto;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    #resultsHeader {
      margin-bottom: 35px;
    }
    
    #resultsHeader h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 28px;
      font-weight: 700;
    }
    
    #dominantDomainsText {
      font-size: 20px;
      color: #555;
      margin-bottom: 12px;
      font-weight: 600;
      line-height: 1.4;
    }
    
    #topDomains {
      color: #e91e63;
      font-weight: 700;
    }
    
    #personalityInsight {
      font-size: 16px;
      color: #777;
      margin-bottom: 0;
      font-style: italic;
    }
    
    #scoreSection {
      margin: 40px 0;
      padding: 30px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #e9ecef;
    }
    
    #totalScore {
      font-size: 56px;
      font-weight: 800;
      color: #e91e63;
      margin: 15px 0;
      letter-spacing: -1px;
    }
    
    #ihsLabel {
      font-size: 14px;
      color: #777;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      font-weight: 600;
    }
    
    #colorVisualization {
      margin: 45px 0;
    }
    
    #colorVisualization h3 {
      color: #333;
      margin-bottom: 25px;
      font-size: 22px;
      font-weight: 700;
    }
    
    #colorWheel {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 30px;
      margin: 25px 0;
      padding: 0 10px;
      max-width: 600px;
      margin: 25px auto;
    }
    
    .domain-slice {
      text-align: center;
    }
    
    .slice-color {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      margin: 0 auto 12px auto;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
      transition: transform 0.2s ease;
    }
    
    .slice-color:hover {
      transform: scale(1.05);
    }
    
    .slice-basics { background: #4CAF50; }
    .slice-self-dev { background: #FF9800; }
    .slice-ambition { background: #9C27B0; }
    .slice-vitality { background: #2196F3; }
    .slice-attraction { background: #E91E63; }
    
    .slice-label {
      font-size: 13px;
      color: #666;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .slice-count {
      font-size: 20px;
      color: #333;
      font-weight: 800;
    }
    
    #domainBars {
      margin: 45px 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
    }
    
    .domain-bar {
      margin: 20px 0;
      padding: 15px;
      background: #fafafa;
      border-radius: 8px;
      border: 1px solid #f0f0f0;
    }
    
    .bar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .bar-icon {
      font-size: 18px;
      margin-right: 8px;
    }
    
    .bar-name {
      flex: 1;
      text-align: left;
      font-weight: 700;
      color: #333;
      font-size: 16px;
    }
    
    .bar-count {
      font-weight: 800;
      color: #e91e63;
      font-size: 18px;
      min-width: 30px;
      text-align: right;
    }
    
    .bar-container {
      background: #e0e0e0;
      height: 14px;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }
    
    .bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 1.5s ease-out;
      position: relative;
    }
    
    .bar-basics { background: #4CAF50; }
    .bar-self-dev { background: #FF9800; }
    .bar-ambition { background: #9C27B0; }
    .bar-vitality { background: #2196F3; }
    .bar-attraction { background: #E91E63; }
    
    #personalInsights {
      margin: 45px 0;
      padding: 30px;
      background: #f8f9fa;
      border-radius: 8px;
      text-align: left;
      border: 1px solid #e9ecef;
    }
    
    #personalInsights h3 {
      color: #333;
      margin-bottom: 20px;
      font-size: 22px;
      text-align: center;
      font-weight: 700;
    }
    
    #insightText {
      font-size: 17px;
      color: #555;
      line-height: 1.7;
      margin-bottom: 25px;
      text-align: center;
      padding: 0 10px;
    }
    
    #recommendations h4 {
      color: #333;
      margin-bottom: 15px;
      font-size: 18px;
      font-weight: 700;
    }
    
    #recommendationsList {
      list-style: none;
      padding: 0;
    }
    
    #recommendationsList li {
      padding: 12px 0;
      color: #555;
      border-left: 4px solid #e91e63;
      padding-left: 20px;
      margin: 12px 0;
      font-size: 16px;
      line-height: 1.5;
      background: rgba(233, 30, 99, 0.02);
      border-radius: 0 4px 4px 0;
    }
    
    #shareSection {
      margin-top: 45px;
      padding-top: 30px;
      border-top: 2px solid #f0f0f0;
    }
    
    .share-intro {
      font-size: 17px;
      color: #666;
      margin-bottom: 25px;
      font-style: italic;
      line-height: 1.5;
    }
    
    #shareBtn, #retakeBtn {
      padding: 15px 30px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 5px;
    }
    
    #shareBtn {
      background: #e91e63;
      color: white;
    }
    
    #shareBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(233, 30, 99, 0.25);
    }
    
    #retakeBtn {
      background: #f8f9fa;
      color: #333;
      border: 2px solid #e91e63;
    }
    
    #retakeBtn:hover {
      background: #e91e63;
      color: white;
      transform: translateY(-2px);
    }
    
    #socialLinks {
      margin-top: 25px;
      display: flex;
      gap: 15px;
      justify-content: center;
    }
    
    #socialLinks a {
      padding: 12px 25px;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      transition: transform 0.3s ease;
      font-size: 15px;
    }
    
    #tweetLink {
      background: #1da1f2;
      color: white;
    }
    
    #fbLink {
      background: #1877f2;
      color: white;
    }
    
    #socialLinks a:hover {
      transform: translateY(-2px);
    }
    
    /* Share Buttons Styling */
    .share-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 25px 0;
    }
    
    .share-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 14px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }
    
    .share-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }
    
    .share-button.native {
      background: #007AFF;
      color: white;
    }
    
    .share-button.native:hover {
      background: #0056CC;
    }
    
    .share-button.copy {
      background: #f8f9fa;
      color: #333;
      border: 2px solid #e9ecef;
    }
    
    .share-button.copy:hover {
      background: #e9ecef;
      border-color: #dee2e6;
    }
    
    .share-button.copy.copied {
      background: #d4edda;
      border-color: #4CAF50;
      color: #155724;
      animation: successPulse 0.6s ease;
    }
    
    @keyframes successPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    
    .share-icon {
      font-size: 18px;
      font-weight: bold;
    }
    
    @media (max-width: 768px) {
      .share-buttons {
        gap: 10px;
        margin: 20px 0;
      }
      
      .share-button {
        padding: 12px 20px;
        font-size: 15px;
      }
    }
    
    /* Brand Logo Styling */
    .brand-logo {
      width: 150px;
      height: auto;
      margin: 0 auto 20px auto;
      opacity: 1.0;
      display: block;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
    }
    
    /* Hero Image Styling */
    .hero-image {
      width: 100%;
      max-width: 500px;
      height: auto;
      margin: 0 auto 30px auto;
      display: block;
      border-radius: 8px;
      box-shadow: 0 12px 24px rgba(0,0,0,0.15);
      animation: fadeInUp 0.8s ease 0.3s both;
    }
    
    /* Swipe instructions for mobile */
    .swipe-hint {
      display: none;
      font-size: 14px;
      color: #888;
      text-align: center;
      margin-top: 10px;
      font-style: italic;
    }
    
    @media (max-width: 768px) and (pointer: coarse) {
      .swipe-hint {
        display: block;
      }
      
      .buttons {
        margin-top: 30px;
      }
      
      .card-image {
        cursor: grab;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
      }
      
      .card-image:active {
        cursor: grabbing;
      }
    }
    
    /* Mobile Improvements */
    @media (max-width: 480px) {
      .container {
        max-width: 100%;
        padding: 15px;
      }
      
      .hero-image {
        max-width: 100%;
        margin-bottom: 25px;
        border-radius: 6px;
      }
      
      #results {
        padding: 25px 20px;
        margin: 10px;
        max-width: 100%;
      }
      
      #colorWheel {
        grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
        gap: 15px;
        max-width: 100%;
      }
      
      #domainBars {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      #benchmarkStats {
        grid-template-columns: 1fr;
        gap: 15px;
        max-width: 100%;
      }
      
      #resultsHeader h2 {
        font-size: 24px;
      }
      
      #dominantDomainsText {
        font-size: 18px;
      }
      
      #totalScore {
        font-size: 48px;
      }
      
      .slice-color {
        width: 50px;
        height: 50px;
      }
      
      .domain-bar {
        padding: 12px;
      }
      
      #personalInsights {
        padding: 20px;
      }
      
      #insightText {
        font-size: 16px;
      }
      
      #shareBtn, #retakeBtn {
        padding: 12px 25px;
        font-size: 15px;
        display: block;
        width: 100%;
        margin: 8px 0;
      }
    }
    
    /* Tablet and medium screen improvements */
    @media (max-width: 768px) and (min-width: 481px) {
      .container {
        max-width: 95%;
        padding: 20px;
      }
      
      #domainBars {
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
      }
      
      #benchmarkStats {
        grid-template-columns: repeat(2, 1fr);
        max-width: 500px;
      }
    }
    
    /* Benchmark Section Styles */
    #benchmarkSection {
      margin: 45px 0;
      padding: 25px;
      background: #f8f9ff;
      border-radius: 8px;
      border: 1px solid #e3f2fd;
      text-align: center;
    }
    
    #benchmarkSection h3 {
      color: #2c5aa0;
      margin-bottom: 15px;
      font-size: 22px;
      font-weight: 700;
    }
    
    #benchmarkMessage {
      font-size: 18px;
      color: #333;
      margin-bottom: 20px;
      line-height: 1.6;
      font-weight: 500;
      padding: 15px;
      background: rgba(255,255,255,0.7);
      border-radius: 6px;
      border-left: 4px solid #4CAF50;
    }
    
    #benchmarkStats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-top: 20px;
      max-width: 600px;
      margin: 20px auto 0 auto;
    }
    
    .benchmark-item {
      background: white;
      padding: 15px;
      border-radius: 6px;
      border: 1px solid #e0e0e0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .benchmark-label {
      display: block;
      font-size: 13px;
      color: #666;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .benchmark-value {
      display: block;
      font-size: 20px;
      color: #2c5aa0;
      font-weight: 800;
    }
    
    /* Practice Round Indicator */
    .practice-indicator {
      background: #FF9800;
      color: white;
      padding: 6px 16px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin: 0 auto 15px auto;
      display: inline-block;
      opacity: 0.9;
    }
    
    /* Practice mode styling for game container */
    #game.practice-mode {
      background: rgba(255, 152, 0, 0.02);
    }
    
    /* ...existing code... */
  </style>
</head>
<body>
  <div class="container">
    <div id="intro">
      <img src="23plusone.png" alt="23plusone" class="brand-logo">
      
      <div id="introContent">
        <img src="23plusoneunited.gif" alt="United in happiness" class="hero-image">
        <h1>Hello you.</h1>
        <p>Ready for a quick but meaningful test?</p>
        <p>You'll see 24 cards—each showing something we humans love and live for.</p>
        <p>Tap 'Yes' when it speaks to you, swipe it away if not.</p>
        <p>Your happiness score will pop up at the end. Fast instincts = best instincts!</p>
        <p class="lets-go">Let's go!</p>
        
        <button id="startBtn">Start Happiness Scan</button>
      </div>
    </div>

    <div id="game" style="display: none;">
      <img src="23plusone.png" alt="23plusone" class="brand-logo">
      
      <div id="progress">
        <div id="progressBar"></div>
      </div>
      
      <div id="cardContainer">
        <div id="practiceIndicator" class="practice-indicator" style="display: none;">
          Practice
        </div>
        
        <div id="card">
          <div class="loading">Loading cards...</div>
        </div>
        
        <div id="timerContainer" style="display: none;">
          <div id="timerBar">
            <div id="timerProgress"></div>
          </div>
        </div>
      </div>
      
      <div class="buttons" style="display: none;">
        <button id="noBtn">No</button>
        <button id="yesBtn">Yes</button>
      </div>
    </div>

    <div id="results" style="display: none;">
      <img src="23plusone.png" alt="23plusone" class="brand-logo">
      
      <!-- Main Results Header -->
      <div id="resultsHeader">
        <h2>Done! Here's your happiness mix:</h2>
        <div id="dominantDomainsText">You're fueled by <span id="topDomains">--</span> — nice combo!</div>
        <div id="personalityInsight">Your score shows how rich your emotional landscape is today.</div>
      </div>

      <!-- IHS Score Display -->
      <div id="scoreSection">
        <div id="totalScore">--</div>
        <div id="ihsLabel">Individual Happiness Score (IHS)</div>
      </div>

      <!-- Color Visualization -->
      <div id="colorVisualization">
        <h3>Your Happiness Palette</h3>
        <div id="colorWheel">
          <div class="domain-slice" data-domain="Basics">
            <div class="slice-color slice-basics"></div>
            <div class="slice-label">Basics</div>
            <div class="slice-count">0</div>
          </div>
          <div class="domain-slice" data-domain="Self-development">
            <div class="slice-color slice-self-dev"></div>
            <div class="slice-label">Growth</div>
            <div class="slice-count">0</div>
          </div>
          <div class="domain-slice" data-domain="Ambition">
            <div class="slice-color slice-ambition"></div>
            <div class="slice-label">Ambition</div>
            <div class="slice-count">0</div>
          </div>
          <div class="domain-slice" data-domain="Vitality">
            <div class="slice-color slice-vitality"></div>
            <div class="slice-label">Vitality</div>
            <div class="slice-count">0</div>
          </div>
          <div class="domain-slice" data-domain="Attraction">
            <div class="slice-color slice-attraction"></div>
            <div class="slice-label">Beauty</div>
            <div class="slice-count">0</div>
          </div>
        </div>
      </div>

      <!-- Domain Bars -->
      <div id="domainBars">
        <div class="domain-bar" data-domain="Basics">
          <div class="bar-header">
            <span class="bar-icon">🌱</span>
            <span class="bar-name">Fundamentals</span>
            <span class="bar-count">0</span>
          </div>
          <div class="bar-container">
            <div class="bar-fill bar-basics" style="width: 0%"></div>
          </div>
        </div>
        
        <div class="domain-bar" data-domain="Self-development">
          <div class="bar-header">
            <span class="bar-icon">🎨</span>
            <span class="bar-name">Self-Growth</span>
            <span class="bar-count">0</span>
          </div>
          <div class="bar-container">
            <div class="bar-fill bar-self-dev" style="width: 0%"></div>
          </div>
        </div>
        
        <div class="domain-bar" data-domain="Ambition">
          <div class="bar-header">
            <span class="bar-icon">🚀</span>
            <span class="bar-name">Achievement</span>
            <span class="bar-count">0</span>
          </div>
          <div class="bar-container">
            <div class="bar-fill bar-ambition" style="width: 0%"></div>
          </div>
        </div>
        
        <div class="domain-bar" data-domain="Vitality">
          <div class="bar-header">
            <span class="bar-icon">💪</span>
            <span class="bar-name">Energy</span>
            <span class="bar-count">0</span>
          </div>
          <div class="bar-container">
            <div class="bar-fill bar-vitality" style="width: 0%"></div>
          </div>
        </div>
        
        <div class="domain-bar" data-domain="Attraction">
          <div class="bar-header">
            <span class="bar-icon">✨</span>
            <span class="bar-name">Allure</span>
            <span class="bar-count">0</span>
          </div>
          <div class="bar-container">
            <div class="bar-fill bar-attraction" style="width: 0%"></div>
          </div>
        </div>
      </div>

      <!-- Benchmark Section -->
      <div id="benchmarkSection" style="display: none;">
        <h3>How You Compare</h3>
        <div id="benchmarkMessage">Calculating your ranking...</div>
        <div id="benchmarkStats">
          <div class="benchmark-item">
            <span class="benchmark-label">Your Percentile:</span>
            <span class="benchmark-value" id="benchmarkPercentile">--</span>
          </div>
          <div class="benchmark-item">
            <span class="benchmark-label">Total Participants:</span>
            <span class="benchmark-value" id="benchmarkTotal">--</span>
          </div>
          <div class="benchmark-item">
            <span class="benchmark-label">Average Score:</span>
            <span class="benchmark-value" id="benchmarkAverage">--</span>
          </div>
        </div>
      </div>

      <!-- Personalized Insights -->
      <div id="personalInsights">
        <h3>Your Happiness Profile</h3>
        <div id="insightText">Analyzing your unique happiness mix...</div>
        <div id="recommendations">
          <h4>Ways to amplify your joy:</h4>
          <ul id="recommendationsList"></ul>
        </div>
      </div>

      <!-- Share Section -->
      <div id="shareSection">
        <p class="share-intro">More color = more joy. Want to try again and mix it up?</p>
        
        <div class="share-buttons">
          <button id="nativeShareBtn" class="share-button native">
            <span class="share-icon">📤</span>
            <span>Share</span>
          </button>
          <button id="copyLinkBtn" class="share-button copy">
            <span class="share-icon">🔗</span>
            <span>Copy Link</span>
          </button>
        </div>
        
        <button id="retakeBtn" onclick="location.reload()">Take Again</button>
      </div>
    </div>
  </div>

  <script>
  (function() {
    let cards = [];
    let deck = [];
    let currentCardIndex = 0;
    let answers = [];
    let startTime = 0;
    let scanStartTime = 0; // Track start of entire scan
    let timerInterval = null;
    let timerTimeouts = []; // Track all timer-related timeouts
    let timerActive = false; // Flag to prevent timer conflicts
    let isPractice = true;
    
    // DOM elements
    const introDiv = document.getElementById('intro');
    const gameDiv = document.getElementById('game');
    const resultsDiv = document.getElementById('results');
    const startBtn = document.getElementById('startBtn');
    const cardDiv = document.getElementById('card');
    const progressBar = document.getElementById('progressBar');
    const practiceIndicator = document.getElementById('practiceIndicator');
    const timerContainer = document.getElementById('timerContainer');
    const timerProgress = document.getElementById('timerProgress');
    const buttonsDiv = document.querySelector('.buttons');
    const yesBtn = document.getElementById('yesBtn');
    const noBtn = document.getElementById('noBtn');
    
    // Start button event listener
    startBtn.addEventListener('click', startScan);
    
    function startScan() {
      // Hide intro, show game
      introDiv.style.display = 'none';
      gameDiv.style.display = 'flex';
      
      // Initialize the scan
      initializeScan();
    }
    
    // Load cards and initialize
    fetch('cards.json')
      .then(r => r.json())
      .then(json => {
        cards = json;
        // Cards loaded, ready for user to start
        console.log('Cards loaded, ready to start');
      })
      .catch(err => {
        console.error('Error loading cards:', err);
        startBtn.textContent = 'Error loading - Please refresh';
        startBtn.disabled = true;
      });
    
    function initializeScan() {
      // Shuffle all cards once
      const shuffled = [...cards].sort(() => Math.random() - 0.5);
      
      console.log('📋 Total cards available:', cards.length);
      console.log('🔀 Cards after shuffle:', shuffled.length);
      
      // Create deck: 4 practice cards + ALL 24 cards for real scan
      // Practice cards can be any 4 random cards, real scan uses ALL 24 cards
      const practiceCards = shuffled.slice(0, 4).map(card => ({...card, isPractice: true}));
      const realScanCards = [...cards].sort(() => Math.random() - 0.5).map(card => ({...card, isPractice: false})); // All 24 cards, reshuffled
      
      deck = [...practiceCards, ...realScanCards];
      
      console.log('🎯 Deck created:', {
        total: deck.length,
        practice: deck.filter(c => c.isPractice).length,
        real: deck.filter(c => !c.isPractice).length,
        practiceCardIds: practiceCards.map(c => c.id),
        realCardIds: realScanCards.map(c => c.id),
        note: 'Practice uses 4 random cards, real scan uses ALL 24 cards (some may repeat from practice)'
      });
      
      currentCardIndex = 0;
      answers = [];
      scanStartTime = Date.now(); // Record start of entire scan
      showCard();
    }
    
    function showCard() {
      if (currentCardIndex >= deck.length) {
        finishScan();
        return;
      }
      
      const card = deck[currentCardIndex];
      isPractice = card.isPractice;
      
      // Update progress
      const progress = (currentCardIndex / deck.length) * 100;
      progressBar.style.width = progress + '%';
      
      // Show/hide practice indicator
      practiceIndicator.style.display = isPractice ? 'block' : 'none';
      
      // Add/remove practice mode styling
      if (isPractice) {
        gameDiv.classList.add('practice-mode');
      } else {
        gameDiv.classList.remove('practice-mode');
      }
      
      // Display card (visual only - no text labels)
      cardDiv.innerHTML = `
        <div id="cardImages">
          <img src="${card.images[0]}" alt="Happiness card" class="card-image" 
               onerror="this.style.display='none'">
        </div>
        <div class="swipe-hint">Swipe right for Yes, left for No</div>
      `;
      
      // Show timer and buttons
      timerContainer.style.display = 'block';
      buttonsDiv.style.display = 'flex';
      
      // Setup swipe listeners for the new card
      setTimeout(() => setupSwipeListeners(), 100);
      
      // Reset and start timer
      startTimer();
      
      // Record start time for individual card response time
      startTime = Date.now();
    }
    
    function startTimer() {
      // Clear any existing timers first
      if (timerInterval) {
        clearTimeout(timerInterval);
        timerInterval = null;
      }
      
      // Clear all timer-related timeouts
      timerTimeouts.forEach(timeout => clearTimeout(timeout));
      timerTimeouts = [];
      
      // Set timer as active
      timerActive = true;
      
      // Reset timer immediately
      timerProgress.style.transition = 'none';
      timerProgress.style.width = '100%';
      timerProgress.className = ''; // Remove any existing classes
      timerProgress.style.background = '#4CAF50'; // Start with green
      
      // Start countdown after a tiny delay
      const timeout1 = setTimeout(() => {
        if (!timerActive) return; // Don't execute if timer was stopped
        timerProgress.style.transition = 'width 4s linear, background-color 0.3s ease';
        timerProgress.style.width = '0%';
      }, 50);
      timerTimeouts.push(timeout1);
      
      // Color changes during countdown - only if timer still active
      const timeout2 = setTimeout(() => {
        if (!timerActive) return;
        timerProgress.className = 'warning';
      }, 2000);
      timerTimeouts.push(timeout2);
      
      const timeout3 = setTimeout(() => {
        if (!timerActive) return;
        timerProgress.className = 'danger';
      }, 3000);
      timerTimeouts.push(timeout3);
      
      // Auto-submit "No" after 4 seconds
      timerInterval = setTimeout(() => {
        if (!timerActive) return;
        recordAnswer(false);
      }, 4000);
    }
    
    function recordAnswer(isYes) {
      // Stop timer immediately
      timerActive = false;
      
      // Clear main timer
      if (timerInterval) {
        clearTimeout(timerInterval);
        timerInterval = null;
      }
      
      // Clear all timer-related timeouts
      timerTimeouts.forEach(timeout => clearTimeout(timeout));
      timerTimeouts = [];
      
      const responseTime = Date.now() - startTime;
      const card = deck[currentCardIndex];
      
      // Only record non-practice answers
      if (!isPractice) {
        answers.push({
          id: card.id,
          domain: card.domain,
          label: card.label,
          yes: isYes,
          time: responseTime
        });
      }
      
      currentCardIndex++;
      showCard();
    }
    
    function calculateIHS() {
      // Time multipliers based on response speed
      function getTimeMultiplier(time) {
        if (time <= 1000) return 1.0;
        if (time <= 2000) return 0.8;
        if (time <= 3000) return 0.6;
        return 0.4;
      }
      
      // N1: Affirmations + Time
      const n1 = answers
        .filter(a => a.yes)
        .reduce((sum, a) => sum + (4 * getTimeMultiplier(a.time)), 0);
      
      // N2: Domain Coverage
      const uniqueDomains = new Set(answers.filter(a => a.yes).map(a => a.domain));
      const n2 = uniqueDomains.size * 19.2;
      
      // N3: Spread Score
      const domainCounts = {};
      const totalAnswers = answers.length;
      
      answers.filter(a => a.yes).forEach(a => {
        domainCounts[a.domain] = (domainCounts[a.domain] || 0) + 1;
      });
      
      const domainPercentages = Object.values(domainCounts).map(count => count / totalAnswers);
      const spreadDeviation = domainPercentages.reduce((sum, pct) => sum + Math.abs(pct - 0.2), 0);
      const n3 = ((1.6 - spreadDeviation) / 1.6) * 100;
      
      // Final IHS
      const ihs = (0.4 * n1) + (0.4 * n2) + (0.2 * Math.max(0, n3));
      
      return {
        ihs: Math.round(ihs * 10) / 10,
        n1: Math.round(n1 * 10) / 10,
        n2: Math.round(n2 * 10) / 10,
        n3: Math.round(n3 * 10) / 10,
        domainCounts
      };
    }
    
    // Frontend validation to match server-side validation
    function validateScanQuality() {
      const selectedCount = answers.filter(a => a.yes).length;
      const totalResponses = answers.length;
      const totalTime = scanStartTime > 0 ? (Date.now() - scanStartTime) / 1000 : 0; // Use scan start time
      
      console.log('🔍 Frontend validation:', {
        totalResponses,
        selectedCount,
        totalTime: `${totalTime}s`,
        scanStartTime,
        now: Date.now()
      });
      
      // Must have 24 responses
      if (totalResponses !== 24) {
        console.log('❌ Frontend: Incomplete scan');
        return { isValid: false, reason: `Incomplete scan: only ${totalResponses} responses recorded.` };
      }
      
      // Reject all "No" responses
      if (selectedCount === 0) {
        console.log('❌ Frontend: All No responses');
        return { isValid: false, reason: 'You said "No" to everything. Please retake the scan and engage more thoughtfully.' };
      }
      
      // Allow all "Yes" responses - removed restriction
      
      // Allow fast individual clicks but prevent completing entire scan too quickly
      if (totalTime < 5) {
        console.log('❌ Frontend: Too fast completion');
        return { isValid: false, reason: 'Scan completed too quickly. Please take more time to view each image.' };
      }
      
      console.log('✅ Frontend validation passed');
      return { isValid: true, reason: 'Valid scan' };
    }
    
    function showValidationError(reason) {
      cardDiv.innerHTML = `
        <div style="text-align: center; color: #F44336; padding: 20px;">
          <h3 style="color: #F44336; margin-bottom: 15px;">⚠️ Invalid Scan</h3>
          <p style="margin-bottom: 20px;">${reason}</p>
          <button onclick="location.reload()" style="background: #e91e63; color: white; border: none; padding: 12px 24px; border-radius: 20px; cursor: pointer;">
            Retake Scan
          </button>
        </div>
      `;
      
      // Hide timer and buttons
      timerContainer.style.display = 'none';
      buttonsDiv.style.display = 'none';
    }
    
    function finishScan() {
      const results = calculateIHS();
      
      // Validate scan quality before showing results
      const validationResult = validateScanQuality();
      if (!validationResult.isValid) {
        showValidationError(validationResult.reason);
        return;
      }
      
      // Hide game, show results
      gameDiv.style.display = 'none';
      resultsDiv.style.display = 'block';
      
      // Display enhanced results
      displayEnhancedResults(results);
      
      // Get benchmarking data and display
      getBenchmarkData(results);
      
      // Submit to backend
      submitResults(results);
      
      // Setup sharing
      setupSharing(results);
    }
    
    function displayEnhancedResults(results) {
      // Update main score
      document.getElementById('totalScore').textContent = results.ihs;
      
      // Get domain data for visualization
      const domainData = getDomainAnalysis(results.domainCounts);
      
      // Update dominant domains text
      const topDomainsText = getDominantDomainsText(domainData);
      document.getElementById('topDomains').textContent = topDomainsText;
      
      // Update color wheel
      updateColorWheel(results.domainCounts);
      
      // Update domain bars with animation
      updateDomainBars(results.domainCounts);
      
      // Generate personalized insights
      generatePersonalizedInsights(domainData, results);
    }
    
    function getDomainAnalysis(domainCounts) {
      const domains = [
        { name: 'Basics', count: domainCounts['Basics'] || 0, color: '#4CAF50', max: 6 },
        { name: 'Self-development', count: domainCounts['Self-development'] || 0, color: '#FF9800', max: 6 },
        { name: 'Ambition', count: domainCounts['Ambition'] || 0, color: '#9C27B0', max: 8 },
        { name: 'Vitality', count: domainCounts['Vitality'] || 0, color: '#2196F3', max: 2 },
        { name: 'Attraction', count: domainCounts['Attraction'] || 0, color: '#E91E63', max: 2 }
      ];
      
      // Sort by count and calculate percentages
      domains.forEach(domain => {
        domain.percentage = (domain.count / domain.max) * 100;
      });
      
      domains.sort((a, b) => b.count - a.count);
      
      return domains;
    }
    
    function getDominantDomainsText(domainData) {
      const topDomains = domainData.filter(d => d.count > 0).slice(0, 2);
      
      if (topDomains.length === 0) return "exploration and discovery";
      if (topDomains.length === 1) return topDomains[0].name.toLowerCase();
      
      const domainNames = {
        'Basics': 'fundamentals',
        'Self-development': 'growth',
        'Ambition': 'achievement', 
        'Vitality': 'energy',
        'Attraction': 'beauty'
      };
      
      return `${domainNames[topDomains[0].name]} and ${domainNames[topDomains[1].name]}`;
    }
    
    function updateColorWheel(domainCounts) {
      const allDomains = ['Basics', 'Self-development', 'Ambition', 'Vitality', 'Attraction'];
      
      allDomains.forEach(domain => {
        const count = domainCounts[domain] || 0;
        const slice = document.querySelector(`[data-domain="${domain}"] .slice-count`);
        if (slice) {
          slice.textContent = count;
        }
      });
    }
    
    function updateDomainBars(domainCounts) {
      const domainMaxes = {
        'Basics': 6,
        'Self-development': 6, 
        'Ambition': 8,
        'Vitality': 2,
        'Attraction': 2
      };
      
      Object.keys(domainMaxes).forEach(domain => {
        const count = domainCounts[domain] || 0;
        const percentage = (count / domainMaxes[domain]) * 100;
        
        // Update count
        const countElement = document.querySelector(`[data-domain="${domain}"] .bar-count`);
        if (countElement) countElement.textContent = count;
        
        // Animate bar
        setTimeout(() => {
          const barFill = document.querySelector(`[data-domain="${domain}"] .bar-fill`);
          if (barFill) {
            barFill.style.width = percentage + '%';
          }
        }, 500);
      });
    }
    
    function generatePersonalizedInsights(domainData, results) {
      const topDomain = domainData[0];
      const totalSelected = domainData.reduce((sum, d) => sum + d.count, 0);
      
      // Generate insight text
      let insightText = '';
      let recommendations = [];
      
      if (totalSelected <= 5) {
        insightText = "You're selective and intentional with what brings you joy. Quality over quantity defines your happiness approach.";
        recommendations = [
          "Dive deeper into the few things that truly matter to you",
          "Practice mindfulness to appreciate your chosen sources of joy",
          "Consider exploring one new area gradually"
        ];
      } else if (totalSelected <= 12) {
        insightText = "You have a balanced happiness palette - diverse but not overwhelming. You appreciate variety while staying grounded.";
        recommendations = [
          "Keep nurturing your diverse interests",
          "Notice patterns in what consistently brings you joy",
          "Share your balanced approach with others"
        ];
      } else {
        insightText = "You're a happiness maximalist! You find joy in many places and aren't afraid to embrace life's full spectrum.";
        recommendations = [
          "Your enthusiasm is contagious - share it!",
          "Ensure you have time to fully enjoy each source of happiness",
          "Consider prioritizing to avoid happiness overwhelm"
        ];
      }
      
      // Add domain-specific insights
      if (topDomain.count > 0) {
        const domainInsights = {
          'Basics': "Your foundation is strong - you value security, connection, and moral clarity.",
          'Self-development': "You're driven by growth and self-expression - a true lifelong learner.",
          'Ambition': "Achievement and recognition fuel your fire - you're built to succeed.",
          'Vitality': "Energy and health are your superpowers - you prioritize feeling alive.",
          'Attraction': "Beauty and allure matter to you - you appreciate life's aesthetic pleasures."
        };
        
        insightText += ` ${domainInsights[topDomain.name]}`;
      }
      
      // Update the display
      document.getElementById('insightText').textContent = insightText;
      
      const recList = document.getElementById('recommendationsList');
      recList.innerHTML = '';
      recommendations.forEach(rec => {
        const li = document.createElement('li');
        li.textContent = rec;
        recList.appendChild(li);
      });
    }
    
    function submitResults(results) {
      // Create complete card selections with ALL responses
      const cardSelections = {
        domains: [],
        selected: [],    // Cards answered "Yes"
        rejected: [],    // Cards answered "No"
        allResponses: [] // Complete response data
      };
      
      // Process ALL answers (both Yes and No)
      answers.forEach(answer => {
        // Add to complete responses
        cardSelections.allResponses.push({
          cardId: answer.id,
          domain: answer.domain,
          label: answer.label,
          response: answer.yes,
          responseTime: answer.time
        });
        
        // Track selected vs rejected
        if (answer.yes) {
          cardSelections.selected.push(answer.id);
        } else {
          cardSelections.rejected.push(answer.id);
        }
        
        // Track unique domains from all responses
        if (!cardSelections.domains.includes(answer.domain)) {
          cardSelections.domains.push(answer.domain);
        }
      });
      
      const payload = {
        sessionId: `session-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
        cardSelections: cardSelections,
        ihsScore: results.ihs,
        n1Score: results.n1, // Now properly sending calculated N1 score
        n2Score: results.n2, // Now properly sending calculated N2 score
        n3Score: results.n3, // Now properly sending calculated N3 score
        completionTime: scanStartTime > 0 ? Math.round((Date.now() - scanStartTime) / 1000) : 0,
        userAgent: navigator.userAgent,
        totalCards: answers.length, // Should be 24
        selectedCount: cardSelections.selected.length,
        rejectedCount: cardSelections.rejected.length
      };
      
      console.log('Submitting complete scan data:', {
        totalResponses: answers.length,
        selectedCards: cardSelections.selected.length,
        rejectedCards: cardSelections.rejected.length,
        domains: cardSelections.domains.length,
        ihsScore: results.ihs,
        n1Score: results.n1,
        n2Score: results.n2,
        n3Score: results.n3
      });
      
      fetch('/api/responses', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      })
      .then(response => {
        if (!response.ok) {
          console.warn('Failed to submit results:', response.status);
        } else {
          console.log('Results submitted successfully - all 24 cards recorded');
        }
      })
      .catch(err => {
        console.warn('Error submitting results:', err);
      });
    }
    
    function setupSharing(results) {
      const nativeShareBtn = document.getElementById('nativeShareBtn');
      const copyLinkBtn = document.getElementById('copyLinkBtn');
      
      const shareText = `I just completed the 23plusone Happiness Scan and scored ${results.ihs}! Discover what drives your happiness.`;
      const shareUrl = window.location.href;
      
      // Native share handler
      nativeShareBtn.addEventListener('click', async () => {
        if (navigator.share) {
          try {
            await navigator.share({
              title: '23plusone Happiness Scan',
              text: shareText,
              url: shareUrl
            });
          } catch (err) {
            // User cancelled or error occurred, fallback to copy
            if (err.name !== 'AbortError') {
              copyToClipboard(shareUrl, copyLinkBtn);
            }
          }
        } else {
          // Fallback for browsers without Web Share API
          copyToClipboard(shareUrl, copyLinkBtn);
        }
      });
      
      // Copy link handler
      copyLinkBtn.addEventListener('click', () => {
        copyToClipboard(shareUrl, copyLinkBtn);
      });
      
      async function copyToClipboard(text, button) {
        try {
          await navigator.clipboard.writeText(text);
          button.innerHTML = '<span class="share-icon">✓</span><span>Copied!</span>';
          button.classList.add('copied');
          setTimeout(() => {
            button.innerHTML = '<span class="share-icon">🔗</span><span>Copy Link</span>';
            button.classList.remove('copied');
          }, 2000);
        } catch (err) {
          // Fallback for older browsers
          const textArea = document.createElement('textarea');
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          
          button.innerHTML = '<span class="share-icon">✓</span><span>Copied!</span>';
          button.classList.add('copied');
          setTimeout(() => {
            button.innerHTML = '<span class="share-icon">🔗</span><span>Copy Link</span>';
            button.classList.remove('copied');
          }, 2000);
        }
      }
    }
    
    function getBenchmarkData(results) {
      // Show the benchmark section
      const benchmarkSection = document.getElementById('benchmarkSection');
      benchmarkSection.style.display = 'block';
      
      // Convert domain counts to the expected format for the API
      const domainScores = {
        red: results.domainCounts['Attraction'] || 0,      // Beauty/Attraction
        orange: results.domainCounts['Self-development'] || 0, // Growth
        yellow: results.domainCounts['Ambition'] || 0,     // Achievement  
        green: results.domainCounts['Basics'] || 0,        // Fundamentals
        blue: results.domainCounts['Vitality'] || 0        // Energy
      };
      
      const benchmarkPayload = {
        ihsScore: results.ihs,
        domainScores: domainScores
      };
      
      console.log('Requesting benchmark for:', benchmarkPayload);
      
      fetch('/api/benchmarks', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(benchmarkPayload)
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log('Benchmark data received:', data);
        displayBenchmarkResults(data.benchmark);
      })
      .catch(err => {
        console.warn('Error fetching benchmark:', err);
        // Hide benchmark section if there's an error
        benchmarkSection.style.display = 'none';
      });
    }
    
    function displayBenchmarkResults(benchmark) {
      // Update the main benchmark message
      const messageEl = document.getElementById('benchmarkMessage');
      messageEl.textContent = benchmark.message;
      
      // Update the statistics
      document.getElementById('benchmarkPercentile').textContent = `${benchmark.ihsPercentile}th percentile`;
      document.getElementById('benchmarkTotal').textContent = benchmark.totalResponses.toLocaleString();
      document.getElementById('benchmarkAverage').textContent = benchmark.context.averageScore || '--';
      
      // Add some visual flair based on percentile
      const benchmarkSection = document.getElementById('benchmarkSection');
      if (benchmark.ihsPercentile >= 90) {
        benchmarkSection.style.background = '#fff3e0';
        benchmarkSection.style.borderColor = '#ff9800';
      } else if (benchmark.ihsPercentile >= 75) {
        benchmarkSection.style.background = '#e8f5e8';
        benchmarkSection.style.borderColor = '#4caf50';
      } else if (benchmark.ihsPercentile >= 50) {
        benchmarkSection.style.background = '#e3f2fd';
        benchmarkSection.style.borderColor = '#2196f3';
      }
      
      console.log('Benchmark display updated with percentile:', benchmark.ihsPercentile);
    }
    
    // Button event listeners
    yesBtn.addEventListener('click', () => recordAnswer(true));
    noBtn.addEventListener('click', () => recordAnswer(false));
    
    // Touch/swipe functionality for mobile
    let startX = null;
    let startY = null;
    let currentCard = null;
    
    function setupSwipeListeners() {
      const cardImage = document.querySelector('.card-image');
      if (!cardImage) return;
      
      currentCard = cardImage;
      
      // Touch events
      cardImage.addEventListener('touchstart', handleTouchStart, { passive: false });
      cardImage.addEventListener('touchmove', handleTouchMove, { passive: false });
      cardImage.addEventListener('touchend', handleTouchEnd, { passive: false });
      
      // Mouse events for desktop
      cardImage.addEventListener('mousedown', handleMouseDown);
      cardImage.addEventListener('mousemove', handleMouseMove);
      cardImage.addEventListener('mouseup', handleMouseUp);
      cardImage.addEventListener('mouseleave', handleMouseUp);
    }
    
    function handleTouchStart(e) {
      e.preventDefault();
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    }
    
    function handleTouchMove(e) {
      e.preventDefault();
      if (!startX || !startY) return;
      
      const currentX = e.touches[0].clientX;
      const deltaX = currentX - startX;
      
      if (currentCard) {
        currentCard.style.transform = `translateX(${deltaX}px) rotate(${deltaX * 0.1}deg)`;
        currentCard.style.opacity = Math.max(0.3, 1 - Math.abs(deltaX) / 300);
      }
    }
    
    function handleTouchEnd(e) {
      e.preventDefault();
      if (!startX || !currentCard) return;
      
      const endX = e.changedTouches[0].clientX;
      const deltaX = endX - startX;
      
      if (Math.abs(deltaX) > 100) {
        // Swipe detected
        const isYes = deltaX > 0;
        animateCardExit(isYes);
        setTimeout(() => recordAnswer(isYes), 300);
      } else {
        // Snap back
        currentCard.style.transform = '';
        currentCard.style.opacity = '';
      }
      
      startX = null;
      startY = null;
    }
    
    function handleMouseDown(e) {
      e.preventDefault();
      startX = e.clientX;
      startY = e.clientY;
    }
    
    function handleMouseMove(e) {
      if (!startX || !currentCard) return;
      
      const deltaX = e.clientX - startX;
      currentCard.style.transform = `translateX(${deltaX}px) rotate(${deltaX * 0.1}deg)`;
      currentCard.style.opacity = Math.max(0.3, 1 - Math.abs(deltaX) / 300);
    }
    
    function handleMouseUp(e) {
      if (!startX || !currentCard) return;
      
      const deltaX = e.clientX - startX;
      
      if (Math.abs(deltaX) > 100) {
        // Swipe detected
        const isYes = deltaX > 0;
        animateCardExit(isYes);
        setTimeout(() => recordAnswer(isYes), 300);
      } else {
        // Snap back
        currentCard.style.transform = '';
        currentCard.style.opacity = '';
      }
      
      startX = null;
      startY = null;
    }
    
    function animateCardExit(isYes) {
      if (!currentCard) return;
      
      const direction = isYes ? 1 : -1;
      currentCard.style.transform = `translateX(${direction * 400}px) rotate(${direction * 30}deg)`;
      currentCard.style.opacity = '0';
      currentCard.style.transition = 'all 0.3s ease-out';
      
      // Visual feedback on buttons
      if (isYes) {
        yesBtn.style.background = '#66bb6a';
        yesBtn.style.transform = 'scale(1.1)';
      } else {
        noBtn.style.background = '#ef5350';
        noBtn.style.transform = 'scale(1.1)';
      }
      
      setTimeout(() => {
        if (yesBtn) {
          yesBtn.style.background = '';
          yesBtn.style.transform = '';
        }
        if (noBtn) {
          noBtn.style.background = '';
          noBtn.style.transform = '';
        }
      }, 200);
    }
    
    // ...existing code...
  })();
  </script>
</body>
</html>