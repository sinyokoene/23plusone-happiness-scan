<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Research Results</title>
  <link rel="stylesheet" href="styles/tw.build.css">
  <style>
    html, body { height: 100%; }
    body { font-family: Poppins, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .container { max-width: 1200px; margin: 0 auto; padding: 24px; }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 16px; }
    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 16px; }
    .col-6 { grid-column: span 6; }
    .col-12 { grid-column: span 12; }
    canvas { width: 100%; height: 320px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid #eee; padding: 8px; text-align: left; font-size: 12px; }
    /* Clean filter UI */
    .filter-bar { display: flex; flex-wrap: wrap; gap: 10px 12px; align-items: center; }
    .filter-bar label { display: inline-flex; align-items: center; gap: 6px; }
    details.dropdown { position: relative; display: inline-block; }
    summary.filter-summary { list-style: none; border: 1px solid #e5e7eb; border-radius: 8px; padding: 6px 10px; background: #fff; min-width: 180px; padding-right: 28px; cursor: pointer; }
    summary.filter-summary::-webkit-details-marker { display: none; }
    summary.filter-summary:after { content: '▾'; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #6b7280; }
    details[open] > summary.filter-summary { border-color: #f472b6; box-shadow: 0 4px 14px rgba(0,0,0,.08); }
    .dropdown-menu { position: absolute; top: calc(100% + 6px); left: 0; width: 280px; max-height: 300px; overflow: auto; background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; box-shadow: 0 12px 24px rgba(0,0,0,.12); padding: 8px; z-index: 50; }
    .dropdown-header { position: sticky; top: 0; background: #fff; padding-bottom: 6px; margin-bottom: 6px; border-bottom: 1px solid #f3f4f6; }
    .dropdown-header input { width: 100%; border: 1px solid #e5e7eb; border-radius: 6px; padding: 6px 8px; font-size: 13px; }
    .menu-item { display: flex; align-items: center; gap: 8px; padding: 4px 2px; font-size: 13px; }
    .counter { opacity: .7; font-size: 11px; }
  </style>
  <script>window.RESEARCH_RESULTS = true;</script>
</head>
<body class="bg-white text-[#2c1f1c]">
  <main class="container">
    <div class="flex items-center justify-between mb-4">
      <img src="Br-ndLogo.webp" alt="BR-ND People" style="height:48px; width:auto;" />
      <h1 class="text-2xl font-semibold">Research Results</h1>
      <img src="23plusone.png" alt="23plusone" style="height:22px; width:auto;" />
    </div>
    <div class="card mb-4">
      <div class="filter-bar mb-2 text-sm">
        <label>Device
          <select id="filterDevice" class="border rounded px-2 py-1">
            <option value="">All</option>
            <option value="mobile">Mobile</option>
            <option value="desktop">Desktop</option>
          </select>
        </label>
          <div class="h-5 w-px bg-gray-300"></div>
          <label>Sex
            <select id="filterSex" class="border rounded px-2 py-1">
              <option value="">Any</option>
              <option value="female">Female</option>
              <option value="male">Male</option>
              <option value="other">Other</option>
            </select>
          </label>
          <label>Country
            <details id="includeDropdown" class="dropdown">
              <summary class="filter-summary">Select countries <span id="includeCount" class="counter"></span></summary>
              <div class="dropdown-menu">
                <div class="dropdown-header">
                  <input id="includeSearch" type="text" placeholder="Search countries...">
                </div>
                <div id="includeList"></div>
              </div>
            </details>
            <select id="filterCountry" multiple class="border rounded px-2 py-1 w-56" style="display:none;">
              <option value="">Any</option>
            </select>
          </label>
          <label>Exclude Countries <span id="excludeCount" class="counter"></span>
            <details id="excludeDropdown" class="dropdown">
              <summary class="filter-summary" style="min-width:220px">Select to exclude</summary>
              <div class="dropdown-menu">
                <div class="dropdown-header">
                  <input id="excludeSearch" type="text" placeholder="Search countries...">
                </div>
                <div id="excludeList"></div>
              </div>
            </details>
            <select id="excludeCountries" multiple class="border rounded px-2 py-1 w-64" title="Hold Cmd/Ctrl to select multiple" style="display:none;"></select>
          </label>
          <label>Age ≥
            <input id="filterAgeMin" type="number" min="0" max="120" class="border rounded px-2 py-1 w-16" />
          </label>
          <label>≤
            <input id="filterAgeMax" type="number" min="0" max="120" class="border rounded px-2 py-1 w-16" />
          </label>
        <div class="flex items-center gap-2">
          <span>Input:</span>
          <label class="inline-flex items-center gap-1">
            <input id="modClick" type="checkbox" class="align-middle"> <span>Click</span>
          </label>
          <label class="inline-flex items-center gap-1">
            <input id="modSwipe" type="checkbox" class="align-middle"> <span>Swipe</span>
          </label>
          <label class="inline-flex items-center gap-1">
            <input id="modArrow" type="checkbox" class="align-middle"> <span>Arrow</span>
          </label>
        </div>
        <label class="inline-flex items-center gap-2">
          <input id="filterExclusive" type="checkbox" class="align-middle"> <span>Exclusive only</span>
        </label>
        <label class="inline-flex items-center gap-2">
          <input id="filterNoTimeouts" type="checkbox" class="align-middle"> <span>No timeouts</span>
        </label>
        <label class="inline-flex items-center gap-2" title=">300ms & <2000ms, no timeouts, ≤10% outside">
          <input id="filterIat" type="checkbox" class="align-middle"> <span>IAT filter</span>
        </label>
        <label class="inline-flex items-center gap-2" title="Sensitivity analysis">
          <input id="filterSensitivity" type="checkbox" class="align-middle"> <span>Sensitivity</span>
        </label>
        <label class="inline-flex items-center gap-1">
          <span>Threshold ≥</span>
          <input id="filterThreshold" type="number" min="0" max="100" step="5" placeholder="50" class="border rounded px-2 py-1 w-16">
          <span>%</span>
        </label>
        <button id="applyFilters" class="bg-pink-600 text-white text-xs font-semibold rounded px-3 py-1">Apply</button>
      </div>
      <p class="text-sm opacity-80">
        The bar charts show the <strong>distribution</strong> of responses: how many people scored within each range.
        The scatter charts compare questionnaire totals against the scan’s <strong>IHS</strong> score (Intrinsic Happiness Score).
        In the scatter plots, the <strong>X‑axis</strong> is the questionnaire total (WHO‑5% or SWLS 5–35) and the <strong>Y‑axis</strong> is IHS (0–100).
        The thin line is a simple trend line (ordinary least squares); the caption shows correlation <em>r</em>, p‑value, and slope.
      </p>
    </div>
    <div class="grid">
      <div class="col-12">
        <div class="card"><h2 class="text-xl font-semibold">Distributions</h2></div>
      </div>
      <div class="col-6">
        <div class="card">
          <div class="flex items-center justify-between mb-2">
            <h2 class="text-lg font-semibold">WHO‑5 Distribution</h2>
            <label class="text-xs opacity-80 inline-flex items-center gap-1" title="WHO‑5 as % or raw total">
              <span>Scale</span>
              <select id="who5Scale" class="border rounded px-2 py-1 w-28">
                <option value="percent">% (0–100)</option>
                <option value="raw" selected>Raw (0–25)</option>
              </select>
            </label>
          </div>
          <canvas id="who5Chart"></canvas>
          <div id="who5N" class="text-xs opacity-70 mt-1"></div>
        </div>
      </div>
      <div class="col-6">
        <div class="card">
          <div class="flex items-center justify-between mb-2">
            <h2 class="text-lg font-semibold">SWLS Distribution</h2>
            <label class="text-xs opacity-80 inline-flex items-center gap-1" title="SWLS scale 3–21 or rescaled 5–35">
              <span>Scale</span>
              <select id="swlsScale" class="border rounded px-2 py-1 w-28">
                <option value="35">5–35</option>
                <option value="21" selected>3–21</option>
              </select>
            </label>
          </div>
          <canvas id="swlsChart"></canvas>
          <div id="swlsN" class="text-xs opacity-70 mt-1"></div>
        </div>
      </div>
      <div class="col-6">
        <div class="card">
          <h2 class="text-lg font-semibold mb-2">IHS Distribution</h2>
          <canvas id="ihsChart"></canvas>
          <div id="ihsN" class="text-xs opacity-70 mt-1"></div>
        </div>
      </div>
      <div class="col-6">
        <div class="card">
          <h2 class="text-lg font-semibold mb-2">Cantril Distribution</h2>
          <canvas id="cantrilChart"></canvas>
          <div id="cantrilN" class="text-xs opacity-70 mt-1"></div>
        </div>
      </div>
      <div class="col-12">
        <div class="card">
          <div class="flex items-center justify-between mb-2">
            <h2 class="text-lg font-semibold">Response Time by Card</h2>
            <label class="text-sm opacity-80">Card
              <select id="cardTimeSelector" class="border rounded px-2 py-1 text-sm" style="min-width:220px"></select>
            </label>
          </div>
          <p class="text-xs opacity-80 mb-2">Histogram of response times for the selected card (0–4000 ms). Timeouts are excluded.</p>
          <canvas id="cardTimeChart"></canvas>
        </div>
      </div>
      <div class="col-12">
        <div class="card">
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-semibold">Vs IHS</h2>
          </div>
          
        </div>
      </div>
      <div class="col-12">
        <div class="card">
          <div class="flex items-center justify-between mb-2">
            <h2 class="text-xl font-semibold">IHS vs Benchmark</h2>
            <div class="flex items-center gap-3 text-xs">
              <label class="inline-flex items-center gap-1" title="Correlation method for IHS vs Benchmark">
                <span>Method</span>
                <select id="validityMethod" class="border rounded px-2 py-1 w-28">
                  <option value="pearson" selected>Pearson r</option>
                  <option value="spearman">Spearman ρ</option>
                </select>
              </label>
              <label class="inline-flex items-center gap-1" title="Score used for IHS vs Benchmark">
                <span>Score</span>
                <select id="scoreMode" class="border rounded px-2 py-1 w-28">
                  <option value="raw" selected>Raw</option>
                  <option value="tuned">Tuned</option>
                </select>
              </label>
              <label class="inline-flex items-center gap-1" title="Isotonic calibration for AUC (does not change r)">
                <input type="checkbox" id="isoCalibrate" />
                <span>Isotonic</span>
              </label>
              <button id="downloadValidityJson" class="bg-gray-100 border rounded px-2 py-1">Download JSON</button>
              <button id="downloadValidityCsv" class="bg-gray-100 border rounded px-2 py-1">Download CSV</button>
            </div>
          </div>
          <div id="validitySummary" class="text-sm opacity-90"></div>
          <div class="text-[11px] opacity-80 mt-1">IHS is a behavioral score from rapid yes/no card choices; the Benchmark is a composite of WHO‑5, SWLS, and Cantril. Higher r = closer tracking; AUC measures how well IHS identifies the top‑25% on the Benchmark. LOO avoids part‑whole inflation.</div>
          <div id="validityGrader" class="mt-2"></div>
          <div class="grid mt-3" style="grid-template-columns: repeat(12, 1fr); gap: 16px;">
            <div class="col-6">
              <h3 class="font-medium mb-1 text-sm">ROC (IHS for top‑25% Benchmark)</h3>
              <canvas id="validityRoc"></canvas>
            </div>
            <div class="col-6">
              <h3 class="font-medium mb-1 text-sm">Ceiling / Compression</h3>
              <table id="validityCeiling" class="text-xs">
                <thead><tr><th>Measure</th><th>% max</th><th>% top10%</th><th>Skew</th><th>Kurtosis</th></tr></thead>
                <tbody></tbody>
              </table>
              <div id="validityCeilingNote" class="text-[11px] opacity-70 mt-1">Top‑10% = share in highest decile; higher values suggest compression.</div>
            </div>
            <div class="col-12">
              <h3 class="font-medium mb-1 text-sm">Robustness: Base vs Filtered</h3>
              <table id="validityRobustness" class="text-xs">
                <thead><tr><th>Condition</th><th>n</th><th>r(IHS,B)</th><th>AUC</th></tr></thead>
                <tbody></tbody>
              </table>
              <div class="text-[11px] opacity-70 mt-1">Default analysis uses: Click + Arrow inputs, allows ≤1 timeout (or &lt;20% of trials), and per‑person RT denoise; includes all devices/sex. Other settings shown as sensitivity.</div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-6">
        <div class="card">
          <h2 class="text-lg font-semibold mb-2">WHO‑5 vs IHS (scatter)</h2>
          <canvas id="who5VsIhs"></canvas>
        </div>
      </div>
      <div class="col-6">
        <div class="card">
          <h2 class="text-lg font-semibold mb-2">SWLS vs IHS (scatter)</h2>
          <canvas id="swlsVsIhs"></canvas>
        </div>
      </div>
      <div class="col-6">
        <div class="card">
          <h2 class="text-lg font-semibold mb-2">Cantril vs IHS (scatter)</h2>
          <canvas id="cantrilVsIhs"></canvas>
        </div>
      </div>
      
      <div class="col-12">
        <div class="card">
          <div class="flex items-center justify-between mb-2">
            <h2 class="text-lg font-semibold">Overall correlations vs IHS</h2>
            <label class="text-xs opacity-80 inline-flex items-center gap-1" title="Correlation method (applies to all tables and charts)">
              <span>Correlation</span>
              <select id="corrMethod" class="border rounded px-2 py-1 w-28">
                <option value="pearson" selected>Pearson r</option>
                <option value="spearman">Spearman ρ</option>
              </select>
            </label>
          </div>
          <p class="text-xs opacity-80 mt-1">Correlation (<em>r</em>) shows whether two things move together: near +1 = higher X with higher Y; near 0 = no clear link; near −1 = higher X with lower Y. Choose <strong>Pearson</strong> for linear relationships on numeric scales; choose <strong>Spearman</strong> to measure monotonic rank association (robust to outliers and non‑linear monotone shapes). Correlation is not causation.</p>
          <div style="overflow:auto;" class="mt-2">
            <table id="overallCorrTable">
              <thead>
                <tr>
                  <th>Measure</th>
                  <th>n</th>
                  <th>r</th>
                  <th>95% CI</th>
                  <th>p</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <p class="text-[11px] opacity-80 mt-2">Selected method applies to <strong>all</strong> correlations below.</p>
          <p class="text-[11px] opacity-80 mt-1">95% CI: confidence interval for <em>r</em> (shown for Pearson; Spearman CI omitted).</p>
          <p class="text-[11px] opacity-80 mt-1">p: the p‑value for the correlation’s significance. Smaller means less likely by chance.</p>
        </div>
      </div>
      <div class="col-12">
        <div class="card">
          <div class="text-[11px] opacity-90">
            <div class="font-medium mb-1">Correlation color guide</div>
            <div class="grid" style="grid-template-columns: repeat(6, auto); gap: 10px; align-items: center;">
              <div><span style="display:inline-block;width:12px;height:12px;border-radius:4px;background:#e5e7eb;vertical-align:middle;"></span> 0.00–0.10 trivial</div>
              <div><span style="display:inline-block;width:12px;height:12px;border-radius:4px;background:rgba(250,204,21,.20);vertical-align:middle;"></span> 0.10–0.30 small</div>
              <div><span style="display:inline-block;width:12px;height:12px;border-radius:4px;background:rgba(59,130,246,.18);vertical-align:middle;"></span> 0.30–0.50 moderate</div>
              <div><span style="display:inline-block;width:12px;height:12px;border-radius:4px;background:rgba(16,185,129,.18);vertical-align:middle;"></span> 0.50–0.70 strong</div>
              <div><span style="display:inline-block;width:12px;height:12px;border-radius:4px;background:rgba(168,85,247,.20);vertical-align:middle;"></span> 0.70–0.90 very strong</div>
              <div><span style="display:inline-block;width:12px;height:12px;border-radius:4px;background:rgba(236,72,153,.20);vertical-align:middle;"></span> 0.90–1.00 nearly perfect</div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12">
        <div class="card">
          <h2 class="text-lg font-semibold mb-2">Domain Correlations (WHO‑5/SWLS/Cantril)</h2>
          <p class="text-xs opacity-80 mb-2">
            <strong>r(affirm, WHO‑5/SWLS/Cantril)</strong>: time‑weighted “Yes” strength in a domain. Higher r = stronger alignment with well‑being. 
            <strong>r(yes‑rate, WHO‑5/SWLS/Cantril)</strong>: percent “Yes” per domain (no timing); similar meaning, simpler measure.
          </p>
          <div style="overflow:auto;">
            <table id="domainCorrTable">
              <thead>
                <tr>
                  <th>Domain</th>
                  <th>r(affirm, WHO‑5)</th>
                  <th>r(affirm, SWLS)</th>
                  <th>r(affirm, Cantril)</th>
                  <th>r(yes‑rate, WHO‑5)</th>
                  <th>r(yes‑rate, SWLS)</th>
                  <th>r(yes‑rate, Cantril)</th>
                  <th>n</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col-12">
        <div class="card">
          <div class="flex items-center justify-between mb-2">
            <h2 class="text-lg font-semibold">Top/Bottom Cards by Correlation</h2>
            <label class="text-xs opacity-80">Metric
              <select id="cardCorrMetric" class="border rounded px-2 py-1 text-xs">
                <option value="yes" selected>Yes rate</option>
                <option value="affirm">Affirmation (time‑weighted)</option>
              </select>
            </label>
          </div>
          <p class="text-xs opacity-80 mb-2">Cards ranked by how their answers align with WHO‑5/SWLS/Cantril. Choose Yes rate or time‑weighted Affirmation. <span class="opacity-70">n = number of participants with a valid response for that card and a matching questionnaire entry; it can be lower when a response timed out or data is missing.</span></p>
          <div class="grid">
            <div class="col-6">
              <h3 class="font-medium mb-1">Top 12</h3>
              <table id="cardTopWho"><thead><tr><th>Card</th><th id="cardRCol1">r yes (WHO‑5)</th><th id="cardRCol2">r yes (SWLS)</th><th id="cardRCol3">r yes (Cantril)</th><th>n</th></tr></thead><tbody></tbody></table>
            </div>
            <div class="col-6">
              <h3 class="font-medium mb-1">Bottom 12</h3>
              <table id="cardBottomWho"><thead><tr><th>Card</th><th id="cardRCol1b">r yes (WHO‑5)</th><th id="cardRCol2b">r yes (SWLS)</th><th id="cardRCol3b">r yes (Cantril)</th><th>n</th></tr></thead><tbody></tbody></table>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12">
        <div class="card">
          <h2 class="text-lg font-semibold mb-2">Card Selection Ranking (Yes counts)</h2>
          <p class="text-xs opacity-80 mb-2">Ranked by how many times each card was selected “Yes” across the filtered dataset.</p>
          <div style="overflow:auto;">
            <table id="cardYesRankingTable">
              <thead><tr><th>Rank</th><th>Card</th><th>Yes count</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col-12">
        <div class="card">
          <div class="flex items-center justify-between mb-2">
            <h2 class="text-lg font-semibold">Latest Entries</h2>
            <label class="text-sm opacity-80">Limit <input id="limitInput" type="number" value="1500" class="border rounded px-2 py-1 w-20"></label>
          </div>
          <div style="overflow:auto; max-height: 420px;">
            <table id="resultsTable">
              <thead><tr><th>ID</th><th>Created</th><th>Session</th><th>PROLIFIC_PID</th><th>STUDY_ID</th><th>SESSION_ID</th><th>Sex</th><th>Age</th><th>Country</th><th>Device</th><th>Time (s)</th><th>Selected</th><th>Rejected</th><th>Timeouts</th><th>WHO‑5</th><th>SWLS</th><th>Cantril</th><th>IHS</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jstat@1.9.6/dist/jstat.min.js"></script>
  <script src="scripts/research-results.js" defer></script>
  </body>
  </html>


